<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:tr="http://myfaces.apache.org/trinidad"
                xmlns:fn="http://java.sun.com/jsp/jstl/functions">

    <tr:panelBox id="searchPanelBox" inlineStyle="width:100%" partialTriggers="addFieldBtn cancelFieldBtn">

        <tr:panelHorizontalLayout valign="top">
            <f:facet name="separator">
                <tr:spacer width="10" height="5"/>
            </f:facet>

            <!--<trh:script>-->
            <!--dojo.addOnLoad(function () {-->
            <!--document.getElementById('queryTxt').focus();-->
            <!--});-->
            <!--</trh:script>-->

            <tr:commandLink text="Help" action="dialog:help.search"
                            windowWidth="600" windowHeight="500"
                            useWindow="true"
                    >
                <tr:image source="/images/question.png" inlineStyle="vertical-align:middle;padding-left: 3px"
                          shortDesc="Search Help"/>
            </tr:commandLink>

            <tr:outputText value="Query:" inlineStyle="font-weight: bold;font-size: small;"/>
            <tr:inputText id="queryTxt"
                          columns="60" value="#{userQuery.searchQuery}"
                          rows="#{(fn:length(userQuery.searchQuery) / 60) + 1}"
                          onkeypress="return submitEnter('quickSearchBtn',event)"
                          disabled="#{userQuery.showNewFieldPanel or clusteringBean.clusterSelected}"/>
            <tr:commandButton id="quickSearchBtn"
                              text="Search"
                              action="#{searchBean.doNewBinarySearch}"
                              disabled="#{userQuery.showNewFieldPanel or clusteringBean.clusterSelected}"/>
            <tr:commandButton text="Reset All"
                              onclick="queryTxt = document.getElementById('queryTxt'); queryTxt.value = ''; queryTxt.focus()"
                              disabled="#{userQuery.showNewFieldPanel or clusteringBean.clusterSelected}"
                              action="#{searchBean.refresh}"/>

            <tr:commandLink id="addFieldBtn" text="Fields Â»"
                            inlineStyle="font-weight:bold"
                            actionListener="#{userQuery.doShowAddFieldPanel}"
                            disabled="#{userQuery.showNewFieldPanel or clusteringBean.clusterSelected}"
                            partialSubmit="true"/>

        </tr:panelHorizontalLayout>

    </tr:panelBox>

    <tr:panelGroupLayout partialTriggers="addFieldBtn cancelFieldBtn">
        <tr:panelBox inlineStyle="width:100%" rendered="#{userQuery.showNewFieldPanel}">

            <tr:panelHorizontalLayout>
                <f:facet name="separator">
                    <tr:spacer width="8" height="5"/>
                </f:facet>

                <tr:selectOneChoice id="selectOneAndOr" value="#{userQuery.newQueryToken.operandStr}"
                                    disabled="#{userQuery.wildcardQuery}"
                        >
                    <f:selectItem id="andItem" itemValue="AND" itemLabel="AND" />
                    <f:selectItem id="orItem" itemValue="OR" itemLabel="OR" itemDisabled="#{empty userQuery.searchQuery or
                                                                                    userQuery.searchQuery eq '*:*'}"/>
                </tr:selectOneChoice>

                <tr:selectBooleanCheckbox id="notCheckbox" text="NOT" value="#{userQuery.newQueryToken.notQuery}" />

                <tr:selectOneChoice id="newQueryField" label="Field: " value="#{userQuery.newQueryToken.field}"
                                    immediate="true" autoSubmit="true">
                    <f:selectItems value="#{userQuery.searchFieldSelectItems}"/>
                </tr:selectOneChoice>

                <tr:panelGroupLayout id="newQueryValue" partialTriggers="newQueryField">
                    <tr:inputText id="newQueryValueTxt" value="#{userQuery.newQueryToken.query}" columns="35"
                                  immediate="true"
                                  autoSubmit="true"
                                  partialTriggers="newQueryField"
                                  rendered="#{not userQuery.searchFieldsMap[userQuery.newQueryToken.field].autocompleteCapable}"/>

                    <tr:selectOneChoice id="autocompleteList" value="#{userQuery.newQueryToken.query}"
                                        unselectedLabel="Select one"
                                        immediate="true"
                                        autoSubmit="true"
                                        partialTriggers="newQueryField"
                                        rendered="#{userQuery.searchFieldsMap[userQuery.newQueryToken.field].autocompleteCapable}">
                        <f:selectItems id="autocompleteItemsList"
                                       value="#{userQuery.searchFieldsMap[userQuery.newQueryToken.field].autocompleteMethod}"/>
                    </tr:selectOneChoice>
                </tr:panelGroupLayout>

                <tr:commandButton id="addSearchBtn"
                                  text="Add &amp; Search"
                                  actionListener="#{userQuery.doAddFieldToQuery}"
                                  action="#{searchBean.doNewBinarySearch}"/>

                <tr:commandButton id="cancelFieldBtn"
                                  text="Cancel"
                                  actionListener="#{userQuery.doCancelAddField}"
                                  immediate="true"/>

            </tr:panelHorizontalLayout>
        </tr:panelBox>
    </tr:panelGroupLayout>
</ui:composition>
